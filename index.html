<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mammina Camera Distortion</title>
  <style>
    body { margin:0; background:#071827; color:#cfe9ff; text-align:center; }
    h1 { padding:20px; font-size:26px; }
    #controls { padding:20px; }
    button { padding:18px 28px; font-size:20px; margin:8px; background:#2aa1c3; color:#071827; border:none; border-radius:14px; }
    #cameraCanvas { width:100%; max-width:500px; border:3px solid #2aa1c3; border-radius:12px; }
  </style>
</head>
<body>
  <h1>Mammina Mobile Sound Archive</h1>
  <div id="controls">
    <button id="cameraBtn">Open Camera</button>
    <button id="switchCameraBtn">Switch Camera</button>
    <button id="closeCameraBtn" style="display:none;">Close Camera</button>
  </div>
  <video id="cameraFeed" autoplay playsinline muted style="display:none;"></video>
  <canvas id="cameraCanvas"></canvas>

<script>
let cameraStream, usingFrontCamera = true;
const cameraFeed = document.getElementById("cameraFeed");
const cameraCanvas = document.getElementById("cameraCanvas");
const ctx = cameraCanvas.getContext("2d");

async function startCamera() {
  const constraints = { video: { facingMode: usingFrontCamera ? "user" : "environment" } };
  cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
  cameraFeed.srcObject = cameraStream;
  await cameraFeed.play();
  cameraCanvas.width = cameraFeed.videoWidth;
  cameraCanvas.height = cameraFeed.videoHeight;
  animateDistortion();
  document.getElementById("closeCameraBtn").style.display = "inline-block";
}

function animateDistortion() {
  const w = cameraCanvas.width, h = cameraCanvas.height;
  ctx.clearRect(0,0,w,h);
  ctx.drawImage(cameraFeed,0,0,w,h);
  let frame = ctx.getImageData(0,0,w,h);
  let data = frame.data;
  const time = Date.now()/300;
  // Simple horizontal ripple distortion
  for(let y=0;y<h;y++){
    const offset = Math.floor(10*Math.sin(y/30 + time));
    for(let x=w-1;x>=0;x--){
      const i = (y*w + x)*4;
      const j = (y*w + ((x+offset+w)%w))*4;
      data[i]=data[j]; data[i+1]=data[j+1]; data[i+2]=data[j+2];
    }
  }
  ctx.putImageData(frame,0,0);
  requestAnimationFrame(animateDistortion);
}

document.getElementById("cameraBtn").addEventListener("click", startCamera);
document.getElementById("switchCameraBtn").addEventListener("click", async ()=>{
  if(cameraStream) cameraStream.getTracks().forEach(t=>t.stop());
  usingFrontCamera=!usingFrontCamera;
  await startCamera();
});
document.getElementById("closeCameraBtn").addEventListener("click", ()=>{
  if(cameraStream){
    cameraStream.getTracks().forEach(t=>t.stop());
    cameraFeed.srcObject=null;
    ctx.clearRect(0,0,cameraCanvas.width,cameraCanvas.height);
    document.getElementById("closeCameraBtn").style.display="none";
  }
});
</script>
</body>
</html>





